# IAP Smoke Test Checklist (Release Gate)

Быстрый чеклист для проверки реальных платежей перед выкладкой.

Рекомендуемая среда:
- тестовый билд из того же `applicationId`, что в консоли магазина,
- внутренний тестовый трек,
- тестовый аккаунт покупателя.

## Предусловия

1. В сцене подключен `UnityIapProvider` (не `MockIapProvider`).
2. `RealMoneyStoreController` ссылается на `UnityIapProvider`.
3. `IdleClickerConfig.realMoneyProducts[].productId` совпадают с продуктами в консоли.
4. Устройство в сети, время системы корректное.

## Smoke Scenarios (7 штук)

### S1. Инициализация магазина
- Действие: запустить игру и открыть экран магазина.
- Ожидается:
  - продукты отображаются,
  - статус не "Store is not ready",
  - цены показаны локализованно (например, в валюте региона).

### S2. Успешная покупка товара
- Действие: купить любой consumable продукт (`iap_starter_supply`).
- Ожидается:
  - покупка проходит без ошибок,
  - в UI увеличивается BioGel и/или активируется буст,
  - кнопка возвращается в состояние "Ready" после завершения.

### S3. Отмена покупки пользователем
- Действие: открыть покупку и отменить в системном диалоге.
- Ожидается:
  - приложение не падает,
  - награда не выдается,
  - UI показывает отказ/неуспех, дальнейшие покупки возможны.

### S4. Недоступный товар / продукт не найден
- Действие: временно подставить несуществующий productId в одном продукте.
- Ожидается:
  - для этого товара нет успешной покупки,
  - корректная обработка "Product not available",
  - остальные товары продолжают работать.

### S5. Защита от двойной покупки (double-tap)
- Действие: быстро нажимать кнопку одного и того же товара несколько раз.
- Ожидается:
  - в обработке только одна покупка,
  - повторные клики блокируются состоянием "Purchase in progress...",
  - двойной выдачи награды нет.

### S6. Восстановление после временной сетевой ошибки
- Действие: отключить сеть на старте, затем включить и перезапустить сцену/приложение.
- Ожидается:
  - при отсутствии сети покупка недоступна,
  - после восстановления сети инициализация проходит,
  - покупки снова доступны.

### S7. Перезапуск приложения после покупки
- Действие: совершить покупку, закрыть и открыть приложение.
- Ожидается:
  - сохраненные награды остаются в прогрессе,
  - нет повторной "бесплатной" выдачи за ту же транзакцию,
  - магазин остается рабочим.

## Быстрый протокол фиксации результата

Для каждого сценария зафиксировать:
- `PASS / FAIL`
- версия билда,
- устройство/OS,
- регион/валюта стора,
- короткое видео или скрин при `FAIL`.

Готовый шаблон отчета:
- `IAP_SMOKE_TEST_REPORT_TEMPLATE.md`

## Релизный критерий

Релиз блокируется, если:
- любой из S1-S5 падает в `FAIL`,
- есть кейс двойной выдачи награды,
- хотя бы один продукт стабильно недоступен при корректной конфигурации.
